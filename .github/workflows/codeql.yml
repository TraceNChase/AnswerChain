# PowerShell script to implement CodeQL auto-detection

Write-Host "Implementing CodeQL Auto-Detection..." -ForegroundColor Green

# Navigate to project directory
Set-Location "C:\Users\deskt\Desktop\Project_SECQ_CLI\SECQ_CLI"

# Show current status
Write-Host "`nCurrent git status:" -ForegroundColor Yellow
git status

# Replace the workflow file with auto-detection version
Write-Host "`nUpdating .github/workflows/codeql.yml with auto-detection..." -ForegroundColor Green
# (You'll need to manually replace the content with the auto-detection version above)

# Remove unnecessary language-specific config files
Write-Host "`nRemoving language-specific config files..." -ForegroundColor Green

if (Test-Path .github/codeql/config/javascript.yml) {
    git rm .github/codeql/config/javascript.yml
    Write-Host "Removed javascript.yml"
}

if (Test-Path .github/codeql/config/python.yml) {
    git rm .github/codeql/config/python.yml  
    Write-Host "Removed python.yml"
}

if (Test-Path .github/codeql/config/java.yml) {
    git rm .github/codeql/config/java.yml
    Write-Host "Removed java.yml"
}

# Check if config directory is empty and remove if so
$configFiles = Get-ChildItem .github/codeql/config/ -File 2>$null
if ($configFiles.Count -eq 0) {
    Write-Host "Config directory is empty, removing it..."
    git rm -r .github/codeql/config/
}

# Stage all changes
Write-Host "`nStaging changes..." -ForegroundColor Green
git add -A

# Show what will be committed
Write-Host "`nChanges to be committed:" -ForegroundColor Yellow
git status --staged

# Commit changes
Write-Host "`nCommitting changes..." -ForegroundColor Green
git commit -m "Implement CodeQL auto-detection: remove language-specific configs"

# Push to GitHub
Write-Host "`nPushing to GitHub..." -ForegroundColor Green
git push origin main

Write-Host "`nAuto-detection implementation complete!" -ForegroundColor Green
Write-Host "CodeQL will now automatically detect and scan all supported languages in your repository." -ForegroundColor Cyan